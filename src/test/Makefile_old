# Makefile
# MENU
# Bill Waller
# billxwaller@gmail.com
#
# Makefile for the MENU application suite
#
# If you find the Child exit and signal messages from rsh annoying,
# remove the -DVERBOSE flag from the rsh compile instruction.
# The default is to compile without -DVERBOSE.
#
#
CFLAGS = -O0 -g3 -fdiagnostics-color=always -Wall -Wextra \
		-Wno-unused-parameter -Wno-missing-field-initializers \
		-Wno-unused-function -DNCURSES_WIDECHAR
LIBS =  -lncursesw -ltinfo
LDFLAGS =
CC = gcc
INSTALLED=	$(PREFIX)/bin/menu $(PREFIX)/bin/form $(PREFIX)/bin/pick \
		$(PREFIX)/bin/ckeys	$(PREFIX)/bin/view $(PREFIX)/bin/whence \
		$(PREFIX)/bin/rsh $(PREFIX)/bin/enterchr $(PREFIX)/bin/enterstr \
		$(PREFIX)/bin/iloan

#-----------------------------------------------------------
all:	menu form pick view ckeys whence rsh iloan enterchr enterstr
	@echo Make Complete

menu:	menu.o menu_engine.o parse_menu_desc.o init_view.o \
	 fform.o fields.o pick_engine.o curskeys.o mview.o \
	view_engine.o dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o
	$(CC) $(CFLAGS) menu.o menu_engine.o parse_menu_desc.o  init_view.o \
	 fform.o fields.o pick_engine.o curskeys.o mview.o \
	view_engine.o dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o \
   	$(LDFLAGS) -o $@ $(LIBS)
#-----------------------------------------------------------
menu.o: menu.c menu.h
	$(CC) $(CFLAGS) -c menu.c
menu_engine.o: menu_engine.c menu.h
	$(CC) $(CFLAGS) -c menu_engine.c
parse_menu_desc.o: parse_menu_desc.c menu.h
	$(CC) $(CFLAGS) -c parse_menu_desc.c
#-----------------------------------------------------------
form:	form.o fields.o fform.o mview.o init_view.o view_engine.o \
	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o
	$(CC) $(CFLAGS) form.o fields.o fform.o mview.o init_view.o view_engine.o \
   	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o $(LDFLAGS) -o $@ $(LIBS)
form.o: form.c menu.h
	$(CC) $(CFLAGS) -c form.c
fform.o: fform.c menu.h
	$(CC) $(CFLAGS) -c fform.c
fields.o:	fields.c menu.h
	$(CC) $(CFLAGS) -c fields.c
#-----------------------------------------------------------
ckeys:	ckeys.o curskeys.o \
   	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o
	$(CC) $(CFLAGS) ckeys.o curskeys.o \
   	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o \
	$(LDFLAGS) -o $@ $(LIBS)
ckeys.o: ckeys.c menu.h
	$(CC) $(CFLAGS) -c ckeys.c
curskeys.o: curskeys.c menu.h
	$(CC) $(CFLAGS) -c curskeys.c
#-----------------------------------------------------------
pick:	pick.o  pick_engine.o mview.o init_view.o view_engine.o \
   	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o 
	$(CC) $(CFLAGS) pick.c  pick_engine.o \
		mview.o init_view.o view_engine.o \
		dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o \
		$(LDFLAGS) -o $@ $(LIBS)
pick.o: pick.c menu.h
	$(CC) $(CFLAGS) -c pick.c
pick_engine.o: pick_engine.c menu.h
	$(CC) $(CFLAGS) -c pick_engine.c
#-----------------------------------------------------------
view: view.o init_view.o view_engine.o mview.o \
   	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o
	$(CC) $(CFLAGS) view.o init_view.o view_engine.o mview.o \
   	dwin.o futil.o init.o mem.o opts.o scriou.o exec.o sig.o \
		$(LDFLAGS) -o $@ $(LIBS)
view.o: view.c menu.h
	$(CC) $(CFLAGS) -c view.c
init_view.o: init_view.c menu.h
	$(CC) $(CFLAGS) -c init_view.c
mview.o: mview.c menu.h
	$(CC) $(CFLAGS) -c mview.c
view_engine.o: view_engine.c menu.h
	$(CC) $(CFLAGS) -c view_engine.c
#-----------------------------------------------------------
enterchr:	enterchr.o dwin.o futil.o init.o mem.o opts.o scriou.o sig.o
	$(CC) $(CFLAGS) enterchr.o dwin.o futil.o init.o mem.o opts.o scriou.o \
	   	sig.o \
		$(LDFLAGS) -o $@ $(LIBS)
enterstr:	enterstr.o dwin.o futil.o init.o mem.o opts.o scriou.o sig.o
	$(CC) $(CFLAGS) enterstr.o dwin.o futil.o init.o mem.o opts.o scriou.o \
		sig.o \
		$(LDFLAGS) -o $@ $(LIBS)
#-----------------------------------------------------------
dwin.o: dwin.c menu.h
	$(CC) $(CFLAGS) -c dwin.c
futil.o: futil.c menu.h
	$(CC) $(CFLAGS) -c futil.c
init.o: init.c menu.h
	$(CC) $(CFLAGS) -c init.c
mem.o: mem.c menu.h
	$(CC) $(CFLAGS) -c mem.c
opts.o: opts.c menu.h
	$(CC) $(CFLAGS) -c opts.c
scriou.o: scriou.c menu.h
	$(CC) $(CFLAGS) -c scriou.c
exec.o: exec.c menu.h
	$(CC) $(CFLAGS) -c exec.c
sig.o: sig.c menu.h
	$(CC) $(CFLAGS) -c sig.c
enterchr.o: enterchr.c menu.h
	$(CC) $(CFLAGS) -c enterchr.c
enterstr.o: enterstr.c menu.h
	$(CC) $(CFLAGS) -c enterstr.c
#-----------------------------------------------------------
whence:	whence.c
	$(CC) $(CFLAGS) whence.c -o $@ -lc
iloan:	iloan.c
	$(CC) $(CFLAGS) iloan.c -o $@ -lc -lm
rsh:	rsh.c
	$(CC) $(CFLAGS) rsh.c -o $@
#	$(CC) $(CFLAGS) -DVERBOSE rsh.c -o $@
#-----------------------------------------------------------

clean:
	rm -rf core *.o menu form  pick view ckeys enterchr enterstr \
		iloan whence rsh make.out $(CFLOW_OUTPUT) *.o *.cflow \
		scan-build scan-build.log

PREFIX=~/menuapp
OWNER=bill
GROUP=users

install:
	./inst.sh	--
	./inst.sh	menu		$(PREFIX)/bin	menu		0711	$(OWNER)	$(GROUP)
	./inst.sh	form		$(PREFIX)/bin	form		0711	$(OWNER)	$(GROUP)
	./inst.sh	pick		$(PREFIX)/bin	pick		0711	$(OWNER)	$(GROUP)
	./inst.sh	ckeys		$(PREFIX)/bin	ckeys		0711	$(OWNER)	$(GROUP)
	./inst.sh	view		$(PREFIX)/bin	view		0711	$(OWNER)	$(GROUP)
	./inst.sh	whence		$(PREFIX)/bin	whence		0711	$(OWNER)	$(GROUP)
	./inst.sh	rsh		$(PREFIX)/bin	rsh		4711	root	root
	./inst.sh	rsh		$(PREFIX)/bin	ush		0711	$(OWNER)	$(GROUP)
	./inst.sh	enterchr	$(PREFIX)/bin	enterchr	0711	$(OWNER)	$(GROUP)
	./inst.sh	enterstr	$(PREFIX)/bin	enterstr	0711	$(OWNER)	$(GROUP)
	./inst.sh	iloan		$(PREFIX)/bin	iloan		0711	$(OWNER)	$(GROUP)
	./inst.sh	-l
	
uninstall:
	rm -fv	$(PREFIX)/bin/menu	\
			$(PREFIX)/bin/form	\
			$(PREFIX)/bin/pick	\
			$(PREFIX)/bin/ckeys	\
			$(PREFIX)/bin/view \
			$(PREFIX)/bin/rsh \
			$(PREFIX)/bin/enterchr \
			$(PREFIX)/bin/enterstr

